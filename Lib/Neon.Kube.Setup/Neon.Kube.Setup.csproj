<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netstandard2.1</TargetFramework>
    <OutputType>Library</OutputType>
    <RootNamespace>Neon.Kube</RootNamespace>
    <Authors>neonFORGE Team</Authors>
    <Version>2.10.0-preview</Version>
    <Company>neonFORGE LLC</Company>
    <Product>neonKUBE</Product>
    <Description>INTERNAL USE ONLY: Core library used by neonKUBE related tooling.</Description>
    <PackageReleaseNotes>https://github.com/nforgeio/neonKUBE/releases</PackageReleaseNotes>
    <Copyright>Copyright Â© 2005-2021 by neonFORGE LLC.  All rights reserved.</Copyright>
    <AssemblyVersion>0.0.0.0</AssemblyVersion>
    <FileVersion>0.0.0.0</FileVersion>
    <LangVersion>latest</LangVersion>
    <IsPackable>true</IsPackable>
    <PackageLicenseUrl></PackageLicenseUrl>
    <PackageProjectUrl>https://github.com/nforgeio/neonKUBE/blob/master/Lib/Neon.Kube.Setup/README.md</PackageProjectUrl>
    <RepositoryType>git</RepositoryType>
    <RepositoryUrl>https://github.com/nforgeio/neonKUBE</RepositoryUrl>
    <PackageRequireLicenseAcceptance>true</PackageRequireLicenseAcceptance>
    <PackageLicenseFile>LICENSE</PackageLicenseFile>
    <Configurations>Debug;Release;CodeDoc</Configurations>
    <PackageIcon>nuget-icon.png</PackageIcon>
    <PackageTags>kubernetes</PackageTags>
    <NoDefaultExcludes>true</NoDefaultExcludes>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <GenerateTargetFrameworkAttribute>true</GenerateTargetFrameworkAttribute>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|netstandard2.1|AnyCPU'">
    <DefineConstants>DEBUG;TRACE</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='CodeDoc|netstandard2.1|AnyCPU'">
    <DefineConstants />
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|netstandard2.1|AnyCPU'">
    <DefineConstants />
  </PropertyGroup>

  <ItemGroup>
    <None Remove="ClusterDefinitions\neon-desktop.hyperv.cluster.yaml" />
    <None Remove="ClusterDefinitions\neon-desktop.wsl2.cluster.yaml" />
    <None Remove="Resources\cluster-manifest.json" />
  </ItemGroup>

  <ItemGroup>
    <EmbeddedResource Include="ClusterDefinitions\neon-desktop.hyperv.cluster.yaml" />
    <EmbeddedResource Include="ClusterDefinitions\neon-desktop.wsl2.cluster.yaml" />
    <EmbeddedResource Include="Resources\cluster-manifest.json" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Neon.Common\Neon.Common.csproj" />
    <ProjectReference Include="..\Neon.Cryptography\Neon.Cryptography.csproj" />
    <ProjectReference Include="..\Neon.Kube.Hosting\Neon.Kube.Hosting.csproj" />
    <ProjectReference Include="..\Neon.Kube\Neon.Kube.csproj" />
  </ItemGroup>

  <ItemGroup>
    <None Include="..\..\LICENSE">
      <Pack>True</Pack>
      <PackagePath></PackagePath>
    </None>
    <None Include="..\nuget-icon.png">
      <Pack>True</Pack>
      <PackagePath></PackagePath>
    </None>
  </ItemGroup>

  <!--
  The [ClusterManifest] build target executes a [neon-build download-const-uri] command to
  download the cluster manifest JSON file for the current cluster version.  The manifest
  will be generated during image builds in neonCLOUD and uploaded to S3.
  
  The [neon-build download-const-uri] obtains the URI for the manifest from:
  
      assembly:   Neon.Kube.dll (netstandard2.1)
      constant:   Neon.Kube.NeonDownloads.NeonClusterManifestUri
  
  We'll be loading the [Neon.Kube.dll] assembly from that project's folder using the same
  build configuration and target runtime as this project.  This is a bit fragile.
  
  Note that the [neon-build download-const-uri] doesn't fail if it couldn't download the
  file so that developers will be able to work offline.  We'll just build with the existing
  manifest file which is checked into git and won't change very often.
  -->

  <Target Name="ClusterManifest" BeforeTargets="CoreCompile">
    <Exec Command="neon-build download-const-uri &quot;%NF_ROOT%\Lib\Neon.Kube\bin\$(Configuration)\netstandard2.1\Neon.Kube.dll&quot; Neon.Kube.KubeDownloads NeonClusterManifestUri &quot;$(ProjectDir)Resources\cluster-manifest.json" />
  </Target>

</Project>
